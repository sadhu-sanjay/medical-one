---
import Card from "../components/Card.astro";
import Card2 from "../components/Card2.astro";
---

<style>
  .bg-layers {
    position: absolute;
    width: 100%;
    transition: all 0.5s ease-in-out;
    aspect-ratio: 1 / 1;
    left: 0%;
    top: 0%;
  }
  .bg-layer-circle {
  }
</style>

<section id="section2" class="rounded-lg relative w-full h-[400dvh]">
  <div class="h-[100dvh] w-full sticky top-0 left-0">
    <div id="second-layer" class="bg-layers bg-secondary "></div>
    <div id="first-layer" class="bg-layers bg-primary-background "></div>
    <!-- <div
      id="third-circle"
      class="absolute m-auto bg-secondary/0.5 w-full aspect-square transition-all ease-in-out duration-300"
    /> -->
    <div
      id="heading2"
      class="transition-all duration-500 ease-in absolute top-1/2 -translate-y-1/2 -translate-x-1/2 left-1/2 w-1/2 mx-auto flex flex-col items-center justify-center gap-8"
    >
      <div
        class="border border-white/0.7 border-1
        text-white/0.7
        tracking-tighter
        rounded-lg px-6 py-2 font-bold flex items-center"
      >
        <p class="font-bold text-4xl">â€¢</p>
        <h1 class="ml-2">The Compounding Effect</h1>
      </div>
      <h1
        class="text-white/0.7 font-extrabold text-6xl
        tracking-tighter
        leading-tight
        text-center"
      >
        Patient safety progress has stalled over the past 30 years
      </h1>
    </div>
    <Card2 title="95%" text="of the data goes unused*" id="card8" className="left-1/2 top-1/2 " headerColor="bg-primary-background" />
    <Card2 title=">80%" text=`safty events goes undocumented*` id="card9" className="left-1/4 top-1/2" header-color="bg-primary" headerColor="bg-secondary" />
    <Card2 title="25%", text="Harm events preventable*" id="card10" className="right-24 top-36 " header-color="bg-primary" headerColor="bg-secondary" />
    <Card2 title="25%", text="Adverse events preventable*" id="card10" className="right-24 bottom-24 " header-color="bg-primary" headerColor="bg-secondary" />
  </div>
</section>

<script is:inline>
  const break4 = 55,
    break5 = 75,
    break6 = 100;

  const card8 = document.getElementById("card8");
  const firstLayer = document.getElementById("first-layer");
  const secondLayer = document.getElementById("second-layer");
  const heading2 = document.getElementById("heading2");

  window.addEventListener("scroll", (any) => {
    const scrollPercentage = Math.round(
      (window.scrollY /
        (document.documentElement.scrollHeight - window.outerHeight)) *
        100
    );
    console.log("section2  %", scrollPercentage);

    function turnIntoCircle(elArray) {
      elArray.forEach((el) => {
        el.style.borderRadius = "50%";
        el.style.width = "50dvw";
        el.style.left = "50%";
        el.style.top = "50%";
        el.style.transform = "translate(-50%, -50%)";
      });
    }
    function turnIntoSmallerCircle(elArray) {
      elArray.forEach((el) => {
        el.style.width = "15dvw";
      });
    }
    function resetCircle(elArray) {
      elArray.forEach((el) => {
        el.style.borderRadius = "0%";
        el.style.width = "100%";
      });
    }

    if (scrollPercentage > break4 && scrollPercentage <= break5) {
      turnIntoCircle([firstLayer]);
      heading2.style.opacity = 0;
      card8.style.opacity = 1;
    } else if (scrollPercentage > break5 && scrollPercentage <= break6) {

      turnIntoSmallerCircle([firstLayer]);
      turnIntoCircle([secondLayer]);

      card8.style.opacity = 0;
    } else if (scrollPercentage > break6 && scrollPercentage >= 100) {

    } else {
      resetCircle([firstLayer, secondLayer]);

      card8.style.opacity = 0;
      heading2.style.opacity = 1;
    }
  });
</script>

<!-- <script is:inline>
  const stickyPercentage = 50;

  const section2 = document.getElementById("section2");
  const primaryCircle = document.getElementById("primary-circle");

  console.log("Section2", section2);
  if (!section2) return;

  window.addEventListener("scroll", (el) => {
    console.log("Section2");

    const percentage = Math.floor(
      (el.target.scrollTop / el.target.scrollHeight) * 100
    );
    console.log("Section2", percentage);

    if (percentage > stickyPercentage) {
      section2.style.position = "sticky;";
    } else {
      section2.style.position = "relative;";
    }

    console.log("2 Page % scrolled", percentage);

    const primaryCircle = document.getElementById("mainbox");
    primaryCircle.style.borderRadius = "0%";
    primaryCircle.style.transition = "all 0.2s";
    primaryCircle.style.transitionTimingFunction = "ease-in-out";
    primaryCircle.style.height = "100vh";
    primaryCircle.style.width = "100vw";
  });

  // Once you scroll past 50%
  function remove() {
    const primaryCircle = document.getElementById("section2");

    // morph it into a circle
    primaryCircle.style.borderRadius = "50%";
    primaryCircle.style.transition = "all 0.2s";
    primaryCircle.style.transitionTimingFunction = "ease-in-out";
    primaryCircle.style.height = "75vh";
    primaryCircle.style.width = "75vh";
  }
</script> -->
